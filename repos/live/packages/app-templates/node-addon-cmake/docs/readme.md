---
id: readme
title: node-addon-cmake
sidebar_label: Readme
hide_title: true
---

# @live/app-templates.node-addon-cmake

For creating native addons using CMake and Conan C/C++ package manager.

## Setup

```
./scripts/carthage.sh bootstrap
```

## Getting Started

```
npm run install
```

## CLion

```
clion .
```

### CMakeLists.txt changes

- After you make a change you must click the reload in the butter bar.
- You can see the output in the CMake tool window.

### Run Configurations

- CMake Application
  - addon - builds the addon into `cmake-build-debug`
  - example - runs the entry point in `src/native/example`
- Custom Build Application
  - `cmake-js && node bin/index.js` - builds and runs our node cli application for debugging
    (See: https://stackoverflow.com/a/65295183/130910)

- npm
  - install
  - conan-install
  - debug-configure

## AppCode

```
appcode build
```

In the project navigator sidebar, select `Files` instead of `Project` - then you can see all the files instead of the shitty XCode virtual folders.

# Project Structure

- src
  - native - c/cpp code
    - example - a c/cpp entry point for development/testing purposes
    - macos - macOS-specific code
    - shared - shared by windows/macos/linux targets

## Artifacts (generated by builders)

- build - `cmake-js` puts all build output here
- build-conan - Conan package manager builds all files here
- cmake-build-debug - CLion puts its CMake build output here

## API

TODO

---

# Conan Package Manager

To use the package manager you must use:

```
cd build
conan install ..
```

NOTE: You may have to run `conan install .. --build=pcre etc.`. It will tell you in the console.

## CLion

See: https://stackoverflow.com/a/65295183/130910

Very useful when making changes to the `CMakeLists.txt` to check if libraries can be found.

# How `cmake-js` works?

`cmake` generates a build toolchain. By default a Makefile and CodeBlocks project. You can also make it generate an XCode project.

`cmake-js print-configure` generates a `cmake ...` command to run.

`cmake-js install` will run this generated `cmake` command.

### `cmake-js` + CLion support

See:

Developing with CLion - https://github.com/cmake-js/cmake-js/issues/23

CMake.js Inclusion Function for ordinary CMake - https://gist.github.com/gdianaty/33c3190a217cd188ea43cd4b06618ba9

>
CLion configures projects and its indexer from `CMakeLists.txt`. Because `cmake-js` passes in some custom flags, we need to have CLion pick them up somehow. This is a script that does that.


To debug set CMakeOptions = `--log-level=VERBOSE` in CLion.

## Electron support

See: https://github.com/cmake-js/cmake-js/issues/222

## cmake + Xcode

The generator `-G` cannot be changed after first invocation. If its changed the `build` dir must be erased.

## cmake-js config

NOTE: Don't use multiple.

- package.json
- .npmrc <-- we use this
- cli args

## XCode

Compiles to build/addon.build/

## Cmake

### `find_library`

From https://cmake.org/cmake/help/latest/command/target_link_libraries.html#id2:

> If the library file is in a macOS framework, the Headers directory of the framework will also be processed as a usage requirement. This has the same effect as passing the framework directory as an include directory.

```
set(CARTHAGE_BUILD_DIR "${CMAKE_SOURCE_DIR}/Carthage/Build/Mac")
find_library(CLJ NAMES CocoaLumberjack HINTS ${CARTHAGE_BUILD_DIR})
```

# Could also use this:

```
target_link_libraries(example ${CMAKE_SOURCE_DIR}/Carthage/Build/Mac/CocoaLumberjack.framework)
#target_link_libraries(example ${CMAKE_SOURCE_DIR}/Carthage/Build/Mac/CocoaLumberjack.framework)
```
